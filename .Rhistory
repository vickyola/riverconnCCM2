#CONT_PIXELS Area upstream the From Node drained by the river segment in 100x100 grid cells
shape_river$alt = shape_river$ALT_GRADIENT
st_geometry(shape_river) <- "geometry"
shape_river_simple <- shape_river %>%
st_as_sf %>%
st_union()
shape_river_line <- shape_river %>% st_cast(.,"LINESTRING" ) %>%
mutate(id = WSO1_ID)  # 1:nrow(.)
#2.3 Dams preprocessing  ##TODO kürzen
##################################################################################
#dams
dams_to_points <- dam %>% mutate(id = GUID) %>% dplyr::select(id)
x <-dams_to_points
#
#
max_dist=90
i= 15
dams <- x[i,]
rivershape <- shape_river_line
dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
#str(nf)
plot(st_geometry(nf))
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams),add=TRUE, col="blue")
i= 16
dams <- x[i,]
rivershape <- shape_river_line
dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
#str(nf)
plot(st_geometry(nf))
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams),add=TRUE, col="blue")
x <-dams_to_points
#2.3 Dams preprocessing  ##TODO kürzen
##################################################################################
#dams
dams_to_points <- dam %>% mutate(id = GUID) %>% dplyr::select(id)
i= 19
dams <- x[i,]
rivershape <- shape_river_line
dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
#str(nf)
plot(st_geometry(nf))
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams),add=TRUE, col="blue")
i= 20
dams <- x[i,]
rivershape <- shape_river_line
dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
#str(nf)
plot(st_geometry(nf))
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams),add=TRUE, col="blue")
i= 21
dams <- x[i,]
rivershape <- shape_river_line
dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
#str(nf)
plot(st_geometry(nf))
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams),add=TRUE, col="blue")
i= 22
dams <- x[i,]
rivershape <- shape_river_line
dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
#str(nf)
plot(st_geometry(nf))
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams),add=TRUE, col="blue")
plot(st_geometry(dams),add=TRUE, col="blue")
i= 23
dams <- x[i,]
rivershape <- shape_river_line
dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
#str(nf)
plot(st_geometry(nf))
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams),add=TRUE, col="blue")
str(dams)
#str(nf)
plot(st_geometry(nf))
plot(st_geometry(dams),add=TRUE, col="blue",pch =9)
plot(st_geometry(dams))#,add=TRUE, col="blue",pch =9)
nf <- lines[st_nearest_feature(dams, lines), ]
#str(nf)
plot(st_geometry(nf))
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams),add=TRUE, col="red",pch =6)
str(dams)
st_crs(dam_in) <- "+proj=longlat +datum=WGS84"
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
nf.segments <- nf.lines %>% st_segmentize( max_dist) %>%   st_cast("POINT")
nf.segments_min <- nf.segments[ which.min(st_distance(nf.segments,dams)),]
plot(st_geometry(nf.segments_min),add=TRUE, col="grey",pch =9)
st_geometry(dams) <- st_geometry(nf.segments_min)
buff <- st_buffer(dams,20)  %>%  st_as_sf
nf.splits <- st_split(nf.lines, buff) %>%  st_cast()%>%
mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 50 )
str(nf.splits)
plot(st_geometry(nf.splits),add=TRUE, col="yellow")
plot(st_geometry(st_startpoint(nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry(st_endpoint(nf.splits[1,])),add=TRUE, col="pink")
i= 23
dams <- x[i,]
str(dams)
rivershape <- shape_river_line
nf <- lines[st_nearest_feature(dams, lines), ]
plot(st_geometry(nf))
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams),add=TRUE, col="red",pch =19)
plot(st_geometry(dams), add=TRUE, col="red", pch =19)
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
nf.segments <- nf.lines %>% st_segmentize( max_dist) %>%   st_cast("POINT")
nf.segments_min <- nf.segments[ which.min(st_distance(nf.segments,dams)),]
plot(st_geometry(nf.segments_min),add=TRUE, col="grey",pch =9)
# ##plot input
plot(st_geometry(shape_basin))
plot(st_geometry(shape_river),add =TRUE)
plot(st_geometry(dam),add =TRUE, col="green")
plot(st_geometry(dam),add =TRUE, col="green" , pch =19)
#
#
max_dist=90
i= 23
#
#
max_dist=9000
i= 23
dams <- x[i,]
str(dams)
rivershape <- shape_river_line
#dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
plot(st_geometry(nf))
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
plot(st_geometry(dams), add=TRUE, col="red", pch =19)
plot(st_geometry(dams), col="red", pch =19)
plot(st_geometry(nf), add=TRUE)
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
if ( as.numeric(st_distance(dams, nf)) < max_dist) {
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
nf.segments <- nf.lines %>% st_segmentize( max_dist) %>%   st_cast("POINT")
nf.segments_min <- nf.segments[ which.min(st_distance(nf.segments,dams)),]
plot(st_geometry(nf.segments_min),add=TRUE, col="grey",pch =9)
st_geometry(dams) <- st_geometry(nf.segments_min)
buff <- st_buffer(dams,20)  %>%  st_as_sf
nf.splits <- st_split(nf.lines, buff) %>%  st_cast()%>%
mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 50 )
str(nf.splits)
plot(st_geometry(nf.splits),add=TRUE, col="yellow")
plot(st_geometry(st_startpoint(nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry(st_endpoint(nf.splits[1,])),add=TRUE, col="pink")
# st_geometry(dams) <- st_geometry(nf.segments_min)
#plot(st_geometry(nf.segments_min),add=TRUE, col="red")
dams <- st_as_sf(dams)
}
return(dams)
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
i= 23
dams <- x[i,]
str(dams)
rivershape <- shape_river_line
#dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
nf.segments <- nf.lines %>% st_segmentize( max_dist) %>%   st_cast("POINT")
nf.segments_min <- nf.segments[ which.min(st_distance(nf.segments,dams)),]
plot(st_geometry(nf.segments_min),add=TRUE, col="grey",pch =9)
st_geometry(dams) <- st_geometry(nf.segments_min)
i= 23
dams <- x[i,]
#str(dams)
rivershape <- shape_river_line
#dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
near.point <- nf.lines[st_nearest_feature(dams, nf.lines), ]
plot(st_geometry(near.point), col="blue", pch =19, add=TRUE)
str8near.point
str(near.point)
near.point <- nf.lines[st_nearest_points(dams, nf.lines), ]
str(near.point)
plot(st_geometry(near.point), col="blue", pch =19, add=TRUE)
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
near.point <- nf.lines[st_nearest_points(dams, nf.lines), ]
near.point <- st_nearest_points(dams, nf.lines)
str(near.point)
plot(st_geometry(near.point), col="blue", pch =19, add=TRUE)
near.point <- st_nearest_points(dams, nf.lines)[nf.lines,]
str(near.point)
near.point <- st_nearest_points(dams, nf.lines)#[nf.lines,]
str(near.point)
near.point <- st_nearest_points(dams, nf.lines)%>%   st_cast("POINT")#[nf.lines,]
str(near.point)
plot(st_geometry(near.point), col="blue", pch =19, add=TRUE)
near.point <- st_nearest_points(dams, nf.lines)%>%   st_cast("POINT")#[nf.lines,]
str(near.point)
plot(st_geometry(near.point), col="blue", pch =19, add=TRUE)
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
near.point <- st_nearest_points(dams, nf.lines)%>%   st_cast("POINT")#[nf.lines,]
str(near.point)
plot(st_geometry(near.point), col="blue", pch =19, add=TRUE)
buff <- st_buffer(dams,1)  %>%  st_as_sf
nf.splits <- st_split(nf.lines, buff) %>%  st_cast()%>%
mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 50 )
nf.splits <- st_split(nf.lines, buff) %>%  st_cast()
str(nf.splits)
plot(st_geometry(buff),add=TRUE, col="yellow")
buff <- st_buffer(dams,10)  %>%  st_as_sf
plot(st_geometry(buff),add=TRUE, col="yellow")
i= 1
dams <- x[i,]
#str(dams)
rivershape <- shape_river_line
#dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
near.point <- st_nearest_points(dams, nf.lines)%>%   st_cast("POINT")  #[nf.lines,]
str(near.point)
plot(st_geometry(near.point), col="cyan", pch =19, add=TRUE)
str(near.point[nf.lines,])
str(near.point[nf.lines])
near.points_min <- near.points[ which.min(st_distance(near.points,nf)),]
near.points <- st_nearest_points(dams, nf.lines)%>%   st_cast("POINT")  #[nf.lines,]
near.points_min <- near.points[ which.min(st_distance(near.points,nf)),]
near.points <- st_nearest_points(dams, nf)%>%   st_cast("POINT")  #[nf.lines,]
near.points <- near.points[which.min(st_distance(nf,near.points)),]
dams_p <- st_nearest_points(dams, nf)%>%   st_cast("POINT") %>%  st_as_sf
dams_p <- dams_p[which.min(st_distance(nf,dams_p)),]
dams_p <- st_nearest_points(dams, nf)%>%   st_cast("POINT") %>%  st_as_sf
dams_p <- dams_p[which.min(st_distance(nf,dams_p)),]
str(dams_p)
plot(st_geometry(dams_p), col="cyan", pch =19, add=TRUE)
st_geometry(dams) <- st_geometry(dams_p)
plot(st_geometry(dams), col="blue", pch =19, add=TRUE)
buff <- st_buffer(dams,10)  %>%  st_as_sf
plot(st_geometry(buff),add=TRUE, col="yellow")
#integrate dam in segment as node
nf.splits <- st_split(nf.lines, buff) %>%  st_cast()
str(nf.splits)
str(nf.splits)
#integrate dam in segment as node
nf.splits <- st_split(nf.lines, buff) %>%  st_cast() %>% mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 50 )
str(nf.splits)
str(nf.splits)
plot(st_geometry(buff),add=TRUE, col="yellow")
buff <- st_buffer(dams,10)  %>%  st_as_sf
plot(st_geometry(buff),add=TRUE, col="yellow")
#integrate dam in segment as node
nf.splits <- st_split(nf.lines, buff) %>%  st_cast() %>% mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 50 )
str(nf.splits)
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
buff <- st_buffer(dams,10)  %>%  st_as_sf
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
#integrate dam in segment as node
nf.splits <- st_split(nf.lines, buff) %>%  st_cast() %>% mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 50 )
str(nf.splits)
plot(st_geometry(nf.splits),add=TRUE, col="yellow")
plot(st_geometry(st_startpoint(nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry(st_endpoint(nf.splits[1,])),add=TRUE, col="pink")
str(nf.splits)
plot(st_geometry(nf.splits),add=TRUE, col="yellow")
plot(st_geometry(st_startpoint(nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry(st_endpoint(nf.splits[1,])),add=TRUE, col="pink")
#integrate dam in segment as node
nf.splits <- st_split(nf, buff) %>%  st_cast() %>% mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 50 )
str(nf.splits)
plot(st_geometry(nf.splits),add=TRUE, col="yellow")
plot(st_geometry(st_startpoint(nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry(st_endpoint(nf.splits[1,])),add=TRUE, col="pink")
i= 2
dams <- x[i,]
#str(dams)
rivershape <- shape_river_line
#dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
startnf = st_startpoint (nf)
endnf = st_endpoint (nf)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
dams_p <- st_nearest_points(dams, nf)%>%   st_cast("POINT") %>%  st_as_sf
dams_p <- dams_p[which.min(st_distance(nf,dams_p)),]
str(dams_p)
plot(st_geometry(dams_p), col="cyan", pch =19, add=TRUE)
st_geometry(dams) <- st_geometry(dams_p)
plot(st_geometry(dams), col="blue", pch =19, add=TRUE)
buff <- st_buffer(dams,10)  %>%  st_as_sf
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
buff <- st_buffer(dams,1000)  %>%  st_as_sf
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
buff <- st_buffer(dams,50)  %>%  st_as_sf
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
plot(st_geometry(nf))
plot(st_geometry(dams), col="blue", pch =19, add=TRUE)
buff <- st_buffer(dams,50)  %>%  st_as_sf
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
plot(st_geometry(nf))
plot(st_geometry(dams), col="blue", pch =19, add=TRUE)
buff <- st_buffer(dams,20)  %>%  st_as_sf
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
#integrate dam in segment as node
nf.splits <- st_split(nf, buff) %>%  st_cast() %>% mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 50 )
#str(nf.splits)
plot(st_geometry(nf.splits),add=TRUE, col="yellow")
plot(st_geometry(st_startpoint(nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry(st_endpoint(nf.splits[1,])),add=TRUE, col="pink")
plot(st_geometry((nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry((nf.splits[1,])),add=TRUE, col="pink")
#str(nf.splits)
plot(st_geometry(nf.splits),add=TRUE, col="yellow")
plot(st_geometry((nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry((nf.splits[2,])),add=TRUE, col="pink")
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
buff <- st_buffer(dams,50)  %>%  st_as_sf
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
#integrate dam in segment as node
nf.splits <- st_split(nf, buff) %>%  st_cast() %>% mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 110 )
plot(st_geometry(nf.splits),add=TRUE, col="yellow")
plot(st_geometry((nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry((nf.splits[2,])),add=TRUE, col="pink")
plot(st_geometry(nf.splits),add=TRUE, col="aquamarine2")
plot(st_geometry((nf.splits[1,])),add=TRUE, col="green")
dams <- st_as_sf(dams)
if ( as.numeric(st_distance(dams, nf)) < max_dist) {
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
dams_p <- st_nearest_points(dams, nf)%>%   st_cast("POINT") %>%  st_as_sf
dams_p <- dams_p[which.min(st_distance(nf,dams_p)),]
str(dams_p)
plot(st_geometry(dams_p), col="cyan", pch =19, add=TRUE)
st_geometry(dams) <- st_geometry(dams_p)
plot(st_geometry(dams), col="blue", pch =19, add=TRUE)
buff <- st_buffer(dams,50)  %>%  st_as_sf
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
#integrate dam in segment as node
nf.splits <- st_split(nf, buff) %>%  st_cast() %>% mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 110 )
plot(st_geometry(nf.splits),add=TRUE, col="brown1")
plot(st_geometry((nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry((nf.splits[2,])),add=TRUE, col="pink")
connected <- st_connect(dams, nf.splits[1,])
#str(nf.splits)
# st_geometry(dams) <- st_geometry(nf.segments_min)
#plot(st_geometry(nf.segments_min),add=TRUE, col="red")
dams <- st_as_sf(dams)
}
#integrate dam in segment as node
nf.splits <- st_split(nf, buff) %>%  st_cast() %>% mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 110 )
plot(st_geometry(nf.splits),add=TRUE, col="brown1")
plot(st_geometry((nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry((nf.splits[2,])),add=TRUE, col="deeppink")
connected <- st_connect(dams, nf.splits[1,])
plot(st_geometry((nf.splits[2,])),add=TRUE, col="cadetblue")
plot(st_geometry((connected)),add=TRUE, col="cadetblue")
connected <- st_connect(dams, nf.splits[1,])
plot(st_geometry((connected)),add=TRUE, col="cadetblue")
remotes::install_github("michaeldorman/nngeo")
library("nngeo")
?st_connect
connected <- st_connect(dams, nf.splits[1,])
plot(st_geometry((connected)),add=TRUE, col="cadetblue")
plot(st_geometry(nf))
connected <- st_connect(dams, nf.splits[1,])
plot(st_geometry((connected)),add=TRUE, col="cadetblue")
plot(st_geometry((connected)),add=TRUE, col="coral")
str(connected)
plot((connected),add=TRUE, col="coral")
View(nf.splits)
str(nf.splits)
i= 2
dams <- x[i,]
#str(dams)
rivershape <- shape_river_line
#dams <- dams
lines <- rivershape %>% st_as_sf()
nf <- lines[st_nearest_feature(dams, lines), ]
plot(st_geometry(nf))
plot(st_geometry(dams), col="red", pch =19, add=TRUE)
plot(st_geometry(endnf),add=TRUE, col="green")
plot(st_geometry(startnf),add=TRUE, col="pink")
nf.points <- nf  %>%  st_as_sf %>%   st_cast("POINT")
nf.lines <- nf  %>%  st_as_sf %>%   st_cast("LINESTRING")
dams_p <- dams_p[which.min(st_distance(nf,dams_p)),]
plot(st_geometry(dams_p), col="cyan", pch =19, add=TRUE)
st_geometry(dams) <- st_geometry(dams_p)
plot(st_geometry(dams), col="blue", pch =19, add=TRUE)
buff <- st_buffer(dams,50)  %>%  st_as_sf
plot(st_geometry(buff), col="yellow", pch =19,add=TRUE)
#integrate dam in segment as node
nf.splits <- st_split(nf, buff) %>%  st_cast() %>% mutate(LENGTH= as.integer( st_length(.))) %>%  subset(. , LENGTH > 110 )
str(nf.splits)
plot(st_geometry(nf.splits),add=TRUE, col="brown1")
plot(st_geometry(nf.splits),add=TRUE, col="cyan")
plot(st_geometry((nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry((nf.splits[2,])),add=TRUE, col="deeppink")
connected <- st_connect(dams, nf.splits[1,])
str(connected)
plot((connected),add=TRUE, col="coral")
plot(st_geometry(nf))
plot((connected),add=TRUE, col="coral")
connected <- st_connect(nf.splits[1,],dams)
str(connected)
plot((connected),add=TRUE, col="coral")
str(nf.splits)
plot(st_geometry(nf.splits),add=TRUE, col="cyan")
plot(st_geometry((nf.splits[1,])),add=TRUE, col="green")
plot(st_geometry((nf.splits[2,])),add=TRUE, col="deeppink")
?st_connect
connected <- st_connect(damsnf.splits[1,])
plot((connected),add=TRUE, col="coral")
str(st_union(nf.splits))
str(st_combine(nf.splits))
